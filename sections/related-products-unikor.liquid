{% assign collection = section.settings.collection | default: product.collections.first %}
{% if collection == blank %}{% assign collection = collections.all %}{% endif %}
{% assign related = collection.products | where: 'available', true %}
{% if product != blank %}{% assign related = related | where_exp: 'p', 'p.id != product.id' %}{% endif %}
{% assign limit_count = section.settings.products_to_show | default: 4 %}
{% assign related = related | limit: limit_count %}

<section class="unikor-related">
  <div class="page-width">
    <h2 class="unikor-related__heading">{{ section.settings.heading | default: 'Check Out Our Wireless Version:' }}</h2>
    <div class="unikor-related__grid">
      {% for prod in related %}
        <a href="{{ prod.url }}" class="unikor-related__card">
          <div class="unikor-related__img-wrap">
            {% if prod.featured_media %}
              <img src="{{ prod.featured_media | image_url: width: 500 }}" alt="{{ prod.title }}" width="500" height="{{ 500 | divided_by: prod.featured_media.aspect_ratio | round }}" loading="lazy">
            {% else %}
              <div class="unikor-related__img-placeholder"><span>Product</span></div>
            {% endif %}
            <span class="unikor-related__badge-60">60</span>
            <div class="unikor-related__badges">
              {% if prod.compare_at_price > prod.price %}
                {% assign save_pct = prod.compare_at_price | minus: prod.price | times: 100 | divided_by: prod.compare_at_price %}
                <span class="unikor-related__save">✓ SAVE {{ save_pct }}%</span>
              {% endif %}
              <span class="unikor-related__as-seen">AS SEEN ON</span>
              <div class="unikor-related__logos">
                <span class="unikor-related__logo-pill">abc</span>
                <span class="unikor-related__logo-pill">WebMD</span>
              </div>
            </div>
          </div>
          <h3 class="unikor-related__title">{{ prod.title }}</h3>
          <div class="unikor-related__price">
            <span class="unikor-related__price-current">{{ prod.price | money }}</span>
            {% if prod.compare_at_price > prod.price %}
              <span class="unikor-related__price-compare">{{ prod.compare_at_price | money }}</span>
            {% endif %}
          </div>
        </a>
      {% endfor %}
      {% if related.size == 0 %}
        <a href="{{ routes.collections_url }}" class="unikor-related__card">
          <div class="unikor-related__img-wrap">
            <div class="unikor-related__img-placeholder"><span>Product image</span></div>
            <span class="unikor-related__badge-60">60</span>
            <div class="unikor-related__badges">
              <span class="unikor-related__save">✓ SAVE 42%</span>
              <span class="unikor-related__as-seen">AS SEEN ON</span>
              <div class="unikor-related__logos">
                <span class="unikor-related__logo-pill">abc</span>
                <span class="unikor-related__logo-pill">WebMD</span>
              </div>
            </div>
          </div>
          <h3 class="unikor-related__title">NightGuard™ Wireless Bedwetting Alarm</h3>
          <div class="unikor-related__price">
            <span class="unikor-related__price-current">$69.00</span>
            <span class="unikor-related__price-compare">$120.00</span>
          </div>
        </a>
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Related products (Unikor)",
  "class": "section-related-unikor",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Check Out Our Wireless Version:" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "products_to_show", "min": 1, "max": 8, "step": 1, "label": "Products to show", "default": 4 }
  ]
}
{% endschema %}
