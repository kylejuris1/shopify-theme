{% assign limit_count = section.settings.products_to_show | default: 4 %}

<section class="unikor-related">
  <div class="page-width">
    <h2 class="unikor-related__heading">{{ section.settings.heading | default: 'Découvrez notre version sans fil :' }}</h2>
    <div class="unikor-related__grid">
      {% assign shown = 0 %}
      {% for block in section.blocks %}
        {% if block.settings.product == blank %}{% continue %}{% endif %}
        {% if shown >= limit_count %}{% break %}{% endif %}
        {% assign shown = shown | plus: 1 %}
        {% assign prod = block.settings.product %}
        <a href="{{ prod.url }}" class="unikor-related__card" {{ block.shopify_attributes }}>
          <div class="unikor-related__img-wrap">
            {% if prod.featured_media %}
              <img src="{{ prod.featured_media | image_url: width: 500 }}" alt="{{ prod.title }}" width="500" height="{{ 500 | divided_by: prod.featured_media.aspect_ratio | round }}" loading="lazy">
            {% else %}
              <div class="unikor-related__img-placeholder"><span>Produit</span></div>
            {% endif %}
            <span class="unikor-related__badge-60">60</span>
            <div class="unikor-related__badges">
              {% if prod.compare_at_price > prod.price %}
                {% assign save_pct = prod.compare_at_price | minus: prod.price | times: 100 | divided_by: prod.compare_at_price %}
                <span class="unikor-related__save">✓ ÉCONOMISEZ {{ save_pct }}%</span>
              {% endif %}
              <span class="unikor-related__as-seen">VU DANS</span>
              <div class="unikor-related__logos">
                <span class="unikor-related__logo-pill">abc</span>
                <span class="unikor-related__logo-pill">WebMD</span>
              </div>
            </div>
          </div>
          <h3 class="unikor-related__title">{{ prod.title }}</h3>
          <div class="unikor-related__price">
            <span class="unikor-related__price-current">{{ prod.price | money }}</span>
            {% if prod.compare_at_price > prod.price %}
              <span class="unikor-related__price-compare">{{ prod.compare_at_price | money }}</span>
            {% endif %}
          </div>
        </a>
      {% endfor %}
      {% if shown == 0 %}
        <a href="{{ routes.collections_url }}" class="unikor-related__card">
          <div class="unikor-related__img-wrap">
            <div class="unikor-related__img-placeholder"><span>Image du produit</span></div>
            <span class="unikor-related__badge-60">60</span>
            <div class="unikor-related__badges">
              <span class="unikor-related__save">✓ ÉCONOMISEZ 42%</span>
              <span class="unikor-related__as-seen">VU DANS</span>
              <div class="unikor-related__logos">
                <span class="unikor-related__logo-pill">abc</span>
                <span class="unikor-related__logo-pill">WebMD</span>
              </div>
            </div>
          </div>
          <h3 class="unikor-related__title">NightGuard™ Wireless Bedwetting Alarm</h3>
          <div class="unikor-related__price">
            <span class="unikor-related__price-current">$69.00</span>
            <span class="unikor-related__price-compare">$120.00</span>
          </div>
        </a>
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Related products",
  "class": "section-related-unikor",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Découvrez notre version sans fil :" },
    { "type": "range", "id": "products_to_show", "min": 1, "max": 8, "step": 1, "label": "Products to show", "default": 4 }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        { "type": "product", "id": "product", "label": "Product" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Related products",
      "settings": { "heading": "Découvrez notre version sans fil :", "products_to_show": 4 },
      "blocks": [
        { "type": "product" },
        { "type": "product" },
        { "type": "product" },
        { "type": "product" }
      ]
    }
  ]
}
{% endschema %}
